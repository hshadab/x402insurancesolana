<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>x402 Insurance - Verifiable Refund Claims for AI Agents</title>
    <link href="https://cdn.prod.website-files.com/65d52b07d5bc41614daa723f/65d531e913836948aa73b883_favicon-novanet.png" rel="shortcut icon" type="image/x-icon"/>
    <link href="https://cdn.prod.website-files.com/65d52b07d5bc41614daa723f/65d532295a03f1655fefe1ff_webclip-novanet.png" rel="apple-touch-icon"/>

    <!-- Story Demo Styles -->
    <link rel="stylesheet" href="/story-demo.css"/>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-primary: #0B0E1C;
            --bg-secondary: #1A1F3A;
            --accent-primary: #00D4FF;
            --accent-secondary: #C0D4E0;
            --accent-warning: #FFB800;
            --accent-danger: #FF4757;
            --text-primary: #FFFFFF;
            --text-secondary: #B8BCC8;
            --panel-bg: rgba(26, 31, 58, 0.95);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
            color: var(--text-primary);
        }

        /* Animated background particles */
        .bg-animation { position: fixed; width: 100%; height: 100%; overflow: hidden; z-index: 0; }
        .particle { position: absolute; width: 4px; height: 4px; background: rgba(0, 212, 255, 0.3); border-radius: 50%; animation: float 20s infinite linear; }

        @keyframes float {
            from { transform: translateY(100vh) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            to { transform: translateY(-100vh) translateX(100px); opacity: 0; }
        }

        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.5} }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Header */
        .header {
            position: fixed; top: 0; left: 0; right: 0;
            background: var(--panel-bg); backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            padding: 15px 30px; z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
        }

        .logo {
            display: flex; align-items: center; gap: 10px;
            cursor: pointer;
            text-decoration: none;
        }

        .logo img {
            height: 32px;
            width: auto;
        }

        .nav-buttons { display: flex; gap: 10px; align-items: center; }
        .nav-btn {
            padding: 8px 16px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: var(--accent-primary);
            cursor: pointer; transition: all 0.3s ease; font-size: 13px;
        }
        .nav-btn:hover { background: rgba(0, 212, 255, 0.2); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3); }

        /* Hero section */
        .hero {
            position: relative;
            z-index: 1;
            padding: 120px 30px 60px;
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .hero-title {
            font-size: 72px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            line-height: 1.1;
        }

        .hero-subtitle {
            font-size: 28px;
            color: var(--text-secondary);
            margin-bottom: 40px;
            font-weight: 300;
        }

        .hero-description {
            font-size: 18px;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto 40px;
            line-height: 1.6;
        }

        .hero-badges {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 50px;
        }

        .badge {
            padding: 10px 20px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 20px;
            font-size: 14px;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Main content */
        .main-content {
            position: relative;
            z-index: 1;
            padding: 0 30px 30px;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Grid layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Card */
        .card {
            background: var(--panel-bg); backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 16px;
            padding: 25px;
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
            border-color: var(--accent-primary);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .card-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Status badge */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        .status-badge.live { background: rgba(0,255,0,0.2); color: #00FF00; }
        .status-badge.pending { background: rgba(255,184,0,0.2); color: #FFB800; }
        .status-badge.paid { background: rgba(0,212,255,0.2); color: #00D4FF; }

        /* Sample data badge */
        .sample-badge {
            display: inline-block;
            padding: 2px 8px;
            margin-left: 8px;
            background: rgba(255, 184, 0, 0.15);
            border: 1px solid rgba(255, 184, 0, 0.4);
            border-radius: 8px;
            font-size: 9px;
            font-weight: 600;
            color: var(--accent-warning);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* List item */
        .list-item {
            padding: 15px;
            background: rgba(0, 212, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid var(--accent-secondary);
            transition: all 0.2s ease;
        }
        .list-item:hover {
            background: rgba(0, 212, 255, 0.1);
            transform: translateX(5px);
        }

        .list-item-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .list-item-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* Proof verification */
        .proof-verifier {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .proof-input {
            width: 100%;
            padding: 12px;
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .proof-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: rgba(0, 212, 255, 0.1);
        }

        .verify-btn {
            width: 100%;
            padding: 12px;
            background: var(--accent-primary);
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .verify-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }

        .proof-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
        }
        .proof-result.success {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            color: #00FF00;
        }
        .proof-result.error {
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid rgba(255, 71, 87, 0.3);
            color: #FF4757;
        }

        /* Code block */
        .code-block {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: var(--accent-secondary);
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            text-align: center;
            padding: 15px;
            background: rgba(0, 212, 255, 0.05);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-primary);
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Loader */
        .loader {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(0, 212, 255, 0.1);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        /* Status indicator */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-indicator.green {
            background: #00FF00;
            animation: pulse 2s infinite;
        }
        .status-indicator.yellow {
            background: #FFB800;
            animation: pulse 2s infinite;
        }

        /* Expandable verification section */
        .verification-section {
            margin-top: 12px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .verification-section.expanded {
            max-height: 800px;
        }

        .verification-toggle {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 6px;
            color: var(--accent-primary);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .verification-toggle:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--accent-primary);
        }

        .verification-toggle svg {
            transition: transform 0.3s ease;
        }

        .verification-toggle.expanded svg {
            transform: rotate(90deg);
        }

        .verification-content {
            margin-top: 12px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
        }

        .verification-field {
            margin-bottom: 15px;
        }

        .verification-field:last-child {
            margin-bottom: 0;
        }

        .verification-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--accent-primary);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .verification-value {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 6px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: var(--text-secondary);
            word-break: break-all;
        }

        .copy-btn {
            flex-shrink: 0;
            padding: 4px 8px;
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 4px;
            color: var(--accent-primary);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .copy-btn:hover {
            background: rgba(0, 212, 255, 0.3);
            border-color: var(--accent-primary);
        }

        .copy-btn.copied {
            background: rgba(0, 255, 0, 0.2);
            border-color: rgba(0, 255, 0, 0.5);
            color: #00FF00;
        }

        .public-inputs-decoded {
            margin-top: 8px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-left: 3px solid var(--accent-primary);
            border-radius: 4px;
            font-size: 11px;
            line-height: 1.6;
        }

        .public-inputs-decoded div {
            margin-bottom: 4px;
        }

        .verify-independently-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, rgba(0, 212, 255, 0.7) 100%);
            color: var(--bg-primary);
            border: none;
            border-radius: 6px;
            font-weight: bold;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 12px;
        }

        .verify-independently-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero { padding: 100px 20px 40px; }
            .hero-title { font-size: 42px; }
            .hero-subtitle { font-size: 20px; }
            .hero-description { font-size: 16px; }
            .main-content { padding: 0 15px 15px; }
            .dashboard-grid { grid-template-columns: 1fr; }
            .card-value { font-size: 28px; }
            .nav-buttons { gap: 5px; }
            .nav-btn { padding: 6px 12px; font-size: 12px; }
        }
    </style>
</head>
<body>
    <!-- Background animation -->
    <div class="bg-animation" id="bgAnimation"></div>

    <!-- Header -->
    <div class="header">
        <a href="https://www.novanet.xyz/" target="_blank" class="logo">
            <img src="https://cdn.prod.website-files.com/65d52b07d5bc41614daa723f/665df12739c532f45b665fe7_logo-novanet.svg" alt="NovaNet Logo">
        </a>

        <div class="nav-buttons">
            <button class="nav-btn" onclick="window.location.href='/'">Home</button>
            <button class="nav-btn" onclick="window.location.href='/docs'">API Docs</button>
            <button class="nav-btn" onclick="window.open('https://github.com/hshadab/x402insurance', '_blank')">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="vertical-align: middle; margin-right: 5px;">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                GitHub
            </button>
        </div>
    </div>

    <!-- Hero Section -->
    <div class="hero">
        <h1 class="hero-title">x402 Insurance ‚ö° Solana</h1>
        <h2 class="hero-subtitle">400ms USDC Refunds ‚Ä¢ Zero-Knowledge Proofs ‚Ä¢ On-Chain Attestation</h2>
        <p class="hero-description">
            Lightning-fast API failure insurance on Solana. Get instant USDC refunds when APIs fail‚Äîpowered by 400ms finality and <a href="https://www.novanet.xyz/" target="_blank" style="color: var(--accent-primary); text-decoration: none;">NovaNet zkEngine</a>. All claims permanently recorded on-chain.
        </p>
        <div class="hero-badges">
            <div class="badge" style="background: linear-gradient(135deg, #9945FF 0%, #14F195 100%); padding: 10px 20px; font-weight: 600;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                </svg>
                Powered by Solana
            </div>
            <a href="https://github.com/ICME-Lab/zkEngine_dev/tree/main" target="_blank" class="badge" style="text-decoration: none; color: var(--accent-primary);">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                </svg>
                zkEngine Proofs
            </a>
            <div class="badge">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                </svg>
                400ms Settlement
            </div>
            <div class="badge">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 6v6l4 2"/>
                </svg>
                Instant Payouts
            </div>
            <div class="badge">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11l3 3L22 4"/>
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                </svg>
                x402 Compliant
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Stats -->
        <div class="dashboard-grid">
            <div class="card" style="border-left: 4px solid #14F195;">
                <div class="card-title">
                    <span class="status-indicator green"></span>
                    Solana Network
                </div>
                <div class="card-value" id="systemStatus">‚ö° Operational</div>
                <div class="card-label" id="networkLabel">Testnet ‚Ä¢ 400ms finality</div>
            </div>

            <div class="card">
                <div class="card-title">
                    <svg style="width: 20px; height: 20px; margin-right: 8px; opacity: 0.6;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6M12 18h.01"/>
                    </svg>
                    USDC Reserve
                </div>
                <div class="card-value" id="usdcReserve">Loading...</div>
                <div class="card-label">Available for refunds</div>
            </div>

            <div class="card">
                <div class="card-title">
                    <svg style="width: 20px; height: 20px; margin-right: 8px; opacity: 0.6;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                    </svg>
                    Total Coverage
                </div>
                <div class="card-value" id="totalCoverage">$0</div>
                <div class="card-label">Active policies</div>
            </div>

            <div class="card">
                <div class="card-title">
                    <svg style="width: 20px; height: 20px; margin-right: 8px; opacity: 0.6;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="9" y1="15" x2="15" y2="15"/>
                    </svg>
                    Total Policies
                </div>
                <div class="card-value" id="totalPolicies">0</div>
                <div class="card-label">Since inception</div>
            </div>

            <div class="card">
                <div class="card-title">
                    <svg style="width: 20px; height: 20px; margin-right: 8px; opacity: 0.6;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                    Claims Paid
                </div>
                <div class="card-value" id="claimsPaid">$0</div>
                <div class="card-label">Via zkEngine proofs</div>
            </div>
        </div>

        <!-- Solana Explorer Widget -->
        <div class="card" style="margin-bottom: 30px; border: 2px solid rgba(148, 69, 255, 0.3);">
            <div class="card-title" style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center;">
                    <svg style="width: 24px; height: 24px; margin-right: 10px; color: #9945FF;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="2" y1="12" x2="22" y2="12"/>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                    </svg>
                    <span style="font-size: 18px;">Solana Testnet Explorer</span>
                </div>
                <div id="explorerLinks" style="display: flex; gap: 10px;">
                    <!-- Explorer buttons will be inserted here -->
                </div>
            </div>

            <div style="margin-top: 20px; padding: 20px; background: rgba(148, 69, 255, 0.05); border-radius: 12px; border: 1px solid rgba(148, 69, 255, 0.2);">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 15px;">
                        <div style="color: #14F195; font-size: 28px; font-weight: 700; margin-bottom: 5px;" id="solanaRefunds">0</div>
                        <div style="color: var(--text-secondary); font-size: 13px;">USDC Refunds Sent</div>
                    </div>
                    <div style="text-align: center; padding: 15px;">
                        <div style="color: #9945FF; font-size: 28px; font-weight: 700; margin-bottom: 5px;" id="solanaProofs">0</div>
                        <div style="color: var(--text-secondary); font-size: 13px;">Proofs Attested On-Chain</div>
                    </div>
                    <div style="text-align: center; padding: 15px;">
                        <div style="color: #00D4FF; font-size: 28px; font-weight: 700; margin-bottom: 5px;" id="avgSettlement">~400ms</div>
                        <div style="color: var(--text-secondary); font-size: 13px;">Avg. Settlement Time</div>
                    </div>
                    <div style="text-align: center; padding: 15px;">
                        <div style="color: #FFB800; font-size: 28px; font-weight: 700; margin-bottom: 5px;" id="gasSaved">99.5%</div>
                        <div style="color: var(--text-secondary); font-size: 13px;">Gas Saved vs Ethereum</div>
                    </div>
                </div>

                <div style="margin-top: 25px; padding: 20px; background: rgba(0, 212, 255, 0.05); border-radius: 8px; border-left: 4px solid var(--accent-primary);">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="8" x2="12" y2="12"/>
                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                        </svg>
                        <strong>Verify Claims On-Chain:</strong>
                    </div>
                    <div style="color: var(--text-primary); font-size: 13px; line-height: 1.8;">
                        All refund transactions and proof attestations are publicly verifiable on Solana Testnet. Click "View on Explorer" below any claim to inspect the transaction, verify the USDC transfer, and audit the proof attestation PDA.
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="nav-btn" onclick="window.open('https://explorer.solana.com/?cluster=testnet', '_blank')" style="font-size: 12px; padding: 8px 12px;">
                            üîó Solana Explorer
                        </button>
                        <button class="nav-btn" onclick="window.open('https://solscan.io/?cluster=testnet', '_blank')" style="font-size: 12px; padding: 8px 12px;">
                            üìä SolScan
                        </button>
                        <button class="nav-btn" onclick="window.open('https://solana.fm/?cluster=testnet-solana', '_blank')" style="font-size: 12px; padding: 8px 12px;">
                            üîç Solana FM
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
            <!-- Recent Policies -->
            <div class="card">
                <div class="card-title">
                    <svg style="width: 20px; height: 20px; margin-right: 8px; opacity: 0.6;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                    </svg>
                    Recent Policies
                </div>
                <div id="recentPolicies">
                    <div class="empty-state">
                        <svg style="width: 48px; height: 48px; opacity: 0.3;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        <div>No policies yet</div>
                    </div>
                </div>
            </div>

            <!-- Recent Claims -->
            <div class="card">
                <div class="card-title">
                    <svg style="width: 20px; height: 20px; margin-right: 8px; opacity: 0.6;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    Recent Claims
                </div>
                <div id="recentClaims">
                    <div class="empty-state">
                        <svg style="width: 48px; height: 48px; opacity: 0.3;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        <div>No claims yet</div>
                    </div>
                </div>
            </div>

            <!-- Solana On-Chain Activity -->
            <div class="card" style="border: 2px solid rgba(153, 69, 255, 0.4);">
                <div class="card-title" style="background: linear-gradient(135deg, rgba(153, 69, 255, 0.1) 0%, rgba(20, 241, 149, 0.1) 100%); margin: -20px -20px 20px -20px; padding: 15px 20px; border-radius: 12px 12px 0 0;">
                    <svg style="width: 20px; height: 20px; margin-right: 8px; color: #9945FF;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                    </svg>
                    <span style="background: linear-gradient(135deg, #9945FF 0%, #14F195 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700;">
                        Solana Activity
                    </span>
                    <span style="margin-left: auto; font-size: 11px; color: #14F195; font-weight: 600;">üü¢ LIVE</span>
                </div>
                <div id="solanaActivity">
                    <div class="empty-state">
                        <svg style="width: 48px; height: 48px; opacity: 0.3;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                        <div>No blockchain activity yet</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Blockchain Stats -->
        <div class="card" id="blockchainCard" style="display: none;">
            <div class="card-title">
                <svg style="width: 20px; height: 20px; margin-right: 8px; opacity: 0.6;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"/>
                    <rect x="14" y="3" width="7" height="7"/>
                    <rect x="14" y="14" width="7" height="7"/>
                    <rect x="3" y="14" width="7" height="7"/>
                </svg>
                Blockchain Status
            </div>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="chainId">8453</div>
                    <div class="stat-label">Chain ID</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="blockNumber"><div class="loader"></div></div>
                    <div class="stat-label">Block Number</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="ethBalance">0</div>
                    <div class="stat-label" id="nativeBalanceLabel">SOL Balance</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="usdcBalance">0</div>
                    <div class="stat-label">USDC Balance</div>
                </div>
            </div>
            <div class="code-block" style="margin-top: 20px;">
Wallet: <span id="walletAddress">Loading...</span>
Network: <span id="networkInfo">Solana Testnet</span>
RPC: <span id="rpcUrl">https://api.testnet.solana.com</span>
USDC Mint: <span id="usdcMint">4zMMC9s...DncDU</span>
Cluster: <span id="clusterType">testnet</span>
            </div>
        </div>

        <!-- How It Works -->
        <div class="card">
            <div class="card-title">
                <svg style="width: 20px; height: 20px; margin-right: 8px; opacity: 0.6;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 16v-4M12 8h.01"/>
                </svg>
                How It Works
            </div>
            <div style="line-height: 1.8; color: var(--text-secondary);">
                <p style="margin-bottom: 15px;">
                    <strong style="color: var(--accent-primary);">1. Agents Buy Insurance</strong><br/>
                    Agents pay a premium (1% of coverage amount) via x402 protocol to insure against API failures. Payments are verified on-chain.
                </p>
                <p style="margin-bottom: 15px;">
                    <strong style="color: var(--accent-primary);">2. zkEngine Generates Proofs</strong><br/>
                    When an API fails, zkEngine analyzes the HTTP response and generates a zero-knowledge proof. The proof cryptographically certifies that failure conditions were met (e.g., status >= 500 or empty response) without exposing the actual response data‚Äîlike proving you know a password without revealing the password itself.
                </p>
                <p>
                    <strong style="color: var(--accent-primary);">3. Lightning-Fast USDC Refunds on Solana</strong><br/>
                    If the proof verifies, USDC refunds are issued via SPL Token transfers in ~400ms on Solana. All transactions and proof attestations are permanently recorded on-chain and publicly auditable via Solana Explorer.
                </p>
            </div>
            <div class="code-block" style="margin-top: 20px;">
# API Failure Detection Logic (proven in zero-knowledge)
def detect_failure(http_status, body_length):
    if http_status >= 500:  # Server error
        return True
    if body_length == 0:     # Empty response
        return True
    return False
            </div>
        </div>
    </div>

    <script>
        // Background particles
        function createParticles() {
            const bgAnimation = document.getElementById('bgAnimation');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                bgAnimation.appendChild(particle);
            }
        }

        // Fetch dashboard data
        async function fetchDashboardData() {
            try {
                const response = await fetch('/api/dashboard');
                const data = await response.json();
                updateDashboard(data);
            } catch (error) {
                console.error('Error fetching dashboard data:', error);
            }
        }

        // Update dashboard
        function updateDashboard(data) {
            // System stats - only update if stats are available
            if (data.stats) {
                document.getElementById('totalCoverage').textContent = '$' + data.stats.total_coverage.toLocaleString();
                document.getElementById('totalPolicies').textContent = data.stats.total_policies;
                document.getElementById('claimsPaid').textContent = '$' + data.stats.claims_paid.toLocaleString();
            }

            // Blockchain stats - only show if data is available
            if (data.blockchain) {
                // Block number (for EVM chains) or slot (for Solana)
                if (data.blockchain.block_number) {
                    document.getElementById('blockNumber').textContent = data.blockchain.block_number.toLocaleString();
                } else if (data.blockchain.slot) {
                    document.getElementById('blockNumber').textContent = data.blockchain.slot.toLocaleString();
                }

                document.getElementById('ethBalance').textContent = data.blockchain.eth_balance || data.blockchain.sol_balance || '0';
                document.getElementById('usdcBalance').textContent = data.blockchain.usdc_balance;
                document.getElementById('usdcReserve').textContent = data.blockchain.usdc_balance + ' USDC';
                document.getElementById('walletAddress').textContent = data.blockchain.wallet_address;
                document.getElementById('blockchainCard').style.display = 'block';

                // Update Solana-specific info if available
                if (data.blockchain.network && data.blockchain.network.toLowerCase().includes('solana')) {
                    document.getElementById('networkLabel').textContent = data.blockchain.cluster + ' ‚Ä¢ 400ms finality';
                    document.getElementById('networkInfo').textContent = 'Solana ' + (data.blockchain.cluster || 'Testnet');
                    document.getElementById('rpcUrl').textContent = data.blockchain.rpc_url || 'https://api.testnet.solana.com';
                    document.getElementById('usdcMint').textContent = '4zMMC9s...DncDU';
                    document.getElementById('clusterType').textContent = data.blockchain.cluster || 'testnet';
                }
            } else {
                document.getElementById('blockchainCard').style.display = 'none';
            }

            // Update Solana Explorer stats
            const totalRefunds = (data.stats && data.stats.claims_paid_count) || data.recent_claims?.length || 0;
            document.getElementById('solanaRefunds').textContent = totalRefunds;
            document.getElementById('solanaProofs').textContent = totalRefunds; // Same as refunds for now

            // Recent policies
            const policiesDiv = document.getElementById('recentPolicies');
            if (data.recent_policies && data.recent_policies.length > 0) {
                policiesDiv.innerHTML = data.recent_policies.map(policy => {
                    // Parse date - handle both ISO string and Unix timestamp
                    const policyTime = typeof policy.created_at === 'string' ?
                        new Date(policy.created_at) :
                        new Date(policy.created_at * 1000);
                    const now = new Date();
                    const hoursAgo = Math.floor((now - policyTime) / (1000 * 60 * 60));
                    const timeDisplay = hoursAgo < 1 ? 'Just now' :
                                       hoursAgo < 24 ? `${hoursAgo}h ago` :
                                       `${Math.floor(hoursAgo / 24)}d ago`;

                    // Parse expiry date - handle both ISO string and duration
                    const expiresAt = policy.expires_at ?
                        (typeof policy.expires_at === 'string' ? new Date(policy.expires_at) : new Date(policy.expires_at * 1000)) :
                        new Date(policyTime.getTime() + (policy.duration || 86400) * 1000);
                    const hoursLeft = Math.max(0, Math.floor((expiresAt - now) / (1000 * 60 * 60)));
                    const expiryDisplay = hoursLeft > 0 ? `Expires in ${hoursLeft}h` : 'Expired';
                    const expiryClass = hoursLeft < 6 ? 'status-badge pending' : 'status-badge live';

                    // Get policy ID - handle both id and policy_id
                    const policyId = policy.id || policy.policy_id || 'unknown';

                    return `
                    <div class="list-item">
                        <div class="list-item-title">
                            üõ°Ô∏è Coverage: <strong>$${policy.coverage_amount.toLocaleString()}</strong>
                            ${policy.is_sample ? '<span class="sample-badge">SAMPLE DATA</span>' : ''}
                        </div>
                        <div class="list-item-meta">
                            <span>üë§ Agent: ${policy.agent_address.substring(0, 6)}...${policy.agent_address.substring(38)}</span>
                            <span>‚è∞ ${timeDisplay}</span>
                            <span class="${expiryClass}">${expiryDisplay}</span>
                        </div>
                        <div style="margin-top: 8px; font-size: 11px; color: var(--text-secondary);">
                            <span>Policy ID: ${policyId.substring(0, 12)}...</span>
                            <span style="margin-left: 15px;">Premium: $${(policy.coverage_amount * 0.01).toFixed(2)}</span>
                        </div>
                    </div>
                `;
                }).join('');
            }

            // Recent claims
            const claimsDiv = document.getElementById('recentClaims');
            if (data.recent_claims && data.recent_claims.length > 0) {
                claimsDiv.innerHTML = data.recent_claims.map((claim, index) => {
                    const claimId = claim.id || claim.claim_id;
                    const shortClaimId = claimId.substring(0, 8);

                    // Decode public inputs
                    const publicInputs = claim.public_inputs || [];
                    const decoded = decodePublicInputs(publicInputs);

                    // Format claim time - handle both ISO string and Unix timestamp
                    const claimTime = claim.created_at ?
                        (typeof claim.created_at === 'string' ? new Date(claim.created_at) : new Date(claim.created_at * 1000)) :
                        new Date();
                    const now = new Date();
                    const minutesAgo = Math.floor((now - claimTime) / (1000 * 60));
                    const timeDisplay = minutesAgo < 1 ? 'Just now' :
                                       minutesAgo < 60 ? `${minutesAgo}m ago` :
                                       minutesAgo < 1440 ? `${Math.floor(minutesAgo / 60)}h ago` :
                                       `${Math.floor(minutesAgo / 1440)}d ago`;

                    // Determine failure reason
                    let failureReason = '';
                    if (claim.http_status >= 500) {
                        failureReason = `Server Error (${claim.http_status})`;
                    } else if (decoded.bodyLength === 0) {
                        failureReason = 'Empty Response';
                    } else {
                        failureReason = `HTTP ${claim.http_status}`;
                    }

                    return `
                    <div class="list-item">
                        <div class="list-item-title">
                            üí∞ Refund: <strong>$${claim.payout_amount.toLocaleString()}</strong>
                            ${claim.is_sample ? '<span class="sample-badge">SAMPLE DATA</span>' : ''}
                        </div>
                        <div class="list-item-meta">
                            <span>‚ö†Ô∏è ${failureReason}</span>
                            <span>‚è∞ ${timeDisplay}</span>
                            <span class="status-badge ${claim.status}">${claim.status === 'paid' ? 'REFUNDED' : claim.status.toUpperCase()}</span>
                        </div>
                        <div style="margin-top: 8px; font-size: 11px; color: var(--text-secondary); display: flex; align-items: center; gap: 10px;">
                            <span>‚úÖ ZK Proof verified</span>
                            <button class="verification-toggle" onclick="toggleVerification('${claimId}', event)">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 18 15 12 9 6"></polyline>
                                </svg>
                                Show Proof Details
                            </button>
                        </div>
                        <div id="verification-${claimId}" class="verification-section">
                            <div class="verification-content">
                                <div class="verification-field">
                                    <div class="verification-label">üìã Claim Summary</div>
                                    <div class="public-inputs-decoded">
                                        <div>‚Ä¢ Claim ID: <strong>${shortClaimId}...${claimId.substring(claimId.length - 8)}</strong></div>
                                        <div>‚Ä¢ API Failure Detected: <strong style="color: ${decoded.fraudDetected ? '#FF4757' : '#00FF00'}">${decoded.fraudDetected ? 'YES' : 'NO'}</strong></div>
                                        <div>‚Ä¢ HTTP Status: <strong>${decoded.httpStatus}</strong> ${decoded.httpStatus >= 500 ? '(Server Error)' : decoded.httpStatus >= 400 ? '(Client Error)' : '(OK)'}</div>
                                        <div>‚Ä¢ Response Size: <strong>${decoded.bodyLength} bytes</strong> ${decoded.bodyLength === 0 ? '(Empty!)' : ''}</div>
                                        <div>‚Ä¢ Payout: <strong style="color: var(--accent-primary)">$${decoded.payoutAmount.toLocaleString()}</strong></div>
                                    </div>
                                </div>

                                <div class="verification-field">
                                    <div class="verification-label">üîê Cryptographic Proof</div>
                                    <div class="verification-value">
                                        <span style="flex: 1;">${claim.proof ? claim.proof.substring(0, 32) + '...' : 'N/A'}</span>
                                        <button class="copy-btn" onclick="copyToClipboard('${claim.proof}', this)">Copy Full</button>
                                    </div>
                                </div>

                                <div class="verification-field">
                                    <div class="verification-label">üìä Public Inputs (zkEngine)</div>
                                    <div class="verification-value">
                                        <span style="flex: 1;">${JSON.stringify(publicInputs)}</span>
                                        <button class="copy-btn" onclick="copyToClipboard('${JSON.stringify(publicInputs).replace(/'/g, "\\'")}', this)">Copy</button>
                                    </div>
                                </div>

                                <div class="verification-field">
                                    <div class="verification-label">üîó Independent Verification</div>
                                    <div class="verification-value">
                                        <span style="flex: 1; font-size: 10px;">curl -X POST https://x402insurance.com/verify -H "Content-Type: application/json" -d '{"proof":"${claim.proof}","public_inputs":${JSON.stringify(publicInputs)}}'</span>
                                        <button class="copy-btn" onclick="copyToClipboard(\`curl -X POST https://x402insurance.com/verify -H &quot;Content-Type: application/json&quot; -d '{&quot;proof&quot;:&quot;${claim.proof}&quot;,&quot;public_inputs&quot;:${JSON.stringify(publicInputs)}}'\`, this)">Copy</button>
                                    </div>
                                </div>

                                ${claim.refund_tx_hash ? `
                                <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, rgba(148, 69, 255, 0.1) 0%, rgba(20, 241, 149, 0.1) 100%); border-radius: 8px; border: 1px solid rgba(148, 69, 255, 0.3);">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#9945FF" stroke-width="2">
                                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                        </svg>
                                        <strong style="color: #9945FF;">Verified on Solana Testnet</strong>
                                    </div>
                                    <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 12px;">
                                        Transaction: <code style="color: var(--accent-primary);">${claim.refund_tx_hash.substring(0, 12)}...${claim.refund_tx_hash.substring(claim.refund_tx_hash.length - 8)}</code>
                                    </div>
                                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                        <button class="nav-btn" onclick="window.open('https://explorer.solana.com/tx/${claim.refund_tx_hash}?cluster=testnet', '_blank')" style="font-size: 11px; padding: 6px 12px;">
                                            üîç Solana Explorer
                                        </button>
                                        <button class="nav-btn" onclick="window.open('https://solscan.io/tx/${claim.refund_tx_hash}?cluster=testnet', '_blank')" style="font-size: 11px; padding: 6px 12px;">
                                            üìä SolScan
                                        </button>
                                        <button class="copy-btn" onclick="copyToClipboard('${claim.refund_tx_hash}', this)" style="font-size: 11px;">
                                            Copy TX Hash
                                        </button>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
                }).join('');
            }

            // Populate Solana Activity from recent transactions
            const activityContainer = document.getElementById('solanaActivity');
            if (activityContainer && data.network === 'solana') {
                // Combine policies, claims, and attestations - sort by date
                const allActivity = [];

                // Add policy premium payments (only if they have real payment_tx)
                if (data.recent_policies && data.recent_policies.length > 0) {
                    data.recent_policies.forEach(policy => {
                        // Only show policies with actual payment transactions (not "pending")
                        if (policy.payment_tx && policy.payment_tx !== 'pending' && !policy.payment_tx.startsWith('0x')) {
                            allActivity.push({
                                type: 'premium',
                                description: `Premium payment: ${(policy.premium || (policy.coverage_amount * 0.01)).toFixed(4)} USDC`,
                                txHash: policy.payment_tx,
                                timestamp: policy.created_at,
                                amount: policy.premium || (policy.coverage_amount * 0.01)
                            });
                        }
                    });
                }

                // Add claim refunds (only real Solana transactions)
                if (data.recent_claims && data.recent_claims.length > 0) {
                    data.recent_claims.forEach(claim => {
                        // Only show refunds with real Solana transaction hashes (not MOCK)
                        if (claim.refund_tx_hash && !claim.refund_tx_hash.startsWith('0xMOCK')) {
                            allActivity.push({
                                type: 'refund',
                                description: `Claim refund: ${(claim.payout_amount || 0).toFixed(4)} USDC`,
                                txHash: claim.refund_tx_hash,
                                timestamp: claim.created_at || claim.paid_at,
                                amount: claim.payout_amount
                            });
                        }

                        // Add ZKP attestations if they exist
                        if (claim.attestation_tx_hash && !claim.attestation_tx_hash.startsWith('0x')) {
                            allActivity.push({
                                type: 'attestation',
                                description: `ZKP proof attested (${claim.http_status} error)`,
                                txHash: claim.attestation_tx_hash,
                                timestamp: claim.created_at,
                                amount: 0
                            });
                        }
                    });
                }

                // Sort by timestamp (newest first) and take top 10
                allActivity.sort((a, b) => {
                    const timeA = typeof a.timestamp === 'string' ? new Date(a.timestamp) : new Date(a.timestamp * 1000);
                    const timeB = typeof b.timestamp === 'string' ? new Date(b.timestamp) : new Date(b.timestamp * 1000);
                    return timeB - timeA;
                });

                if (allActivity.length > 0) {
                    activityContainer.innerHTML = allActivity.slice(0, 10).map(activity => {
                        const timestamp = typeof activity.timestamp === 'string' ?
                            new Date(activity.timestamp) : new Date(activity.timestamp * 1000);
                        const timeStr = timestamp.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });

                        // Icons and colors based on transaction type
                        let icon, color, label;
                        if (activity.type === 'premium') {
                            icon = 'üìù';
                            color = '#9945FF';
                            label = 'Premium Payment';
                        } else if (activity.type === 'attestation') {
                            icon = 'üîê';
                            color = '#FFA500';
                            label = 'ZKP Attestation';
                        } else {
                            icon = 'üí∏';
                            color = '#14F195';
                            label = 'Claim Refund';
                        }

                        // Get Solana cluster from data
                        const cluster = data.cluster || 'devnet';
                        const explorerUrl = `https://explorer.solana.com/tx/${activity.txHash}?cluster=${cluster}`;

                        return `
                        <div class="list-item" style="border-left: 3px solid ${color};">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 20px;">${icon}</span>
                                    <span style="font-size: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">${label}</span>
                                </div>
                                <span style="font-size: 11px; color: var(--text-secondary);">${timeStr}</span>
                            </div>
                            <div style="font-weight: 600; margin-bottom: 6px; font-size: 13px;">${activity.description}</div>
                            <a href="${explorerUrl}" target="_blank" rel="noopener noreferrer"
                               style="font-size: 11px; color: ${color}; text-decoration: none; display: flex; align-items: center; gap: 4px; transition: opacity 0.2s;"
                               onmouseover="this.style.opacity='0.7'" onmouseout="this.style.opacity='1'">
                                <span>TX: ${activity.txHash.substring(0, 8)}...${activity.txHash.substring(activity.txHash.length - 6)}</span>
                                <span style="font-size: 10px;">‚Üó</span>
                            </a>
                        </div>
                        `;
                    }).join('');
                } else {
                    // Show message if no real transactions yet
                    activityContainer.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: var(--text-secondary);">
                            <div style="font-size: 32px; margin-bottom: 12px;">üìã</div>
                            <div style="font-size: 14px;">No Solana transactions yet</div>
                            <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">Create a policy or submit a claim to see activity</div>
                        </div>
                    `;
                }
            }
        }

        // Refresh dashboard
        function refreshDashboard() {
            fetchDashboardData();
        }

        // Decode public inputs
        function decodePublicInputs(publicInputs) {
            // Expected format: [fraud_detected, http_status, body_length, payout_amount]
            if (!publicInputs || publicInputs.length < 4) {
                return {
                    fraudDetected: false,
                    httpStatus: 0,
                    bodyLength: 0,
                    payoutAmount: 0
                };
            }

            return {
                fraudDetected: publicInputs[0] === 1,
                httpStatus: publicInputs[1],
                bodyLength: publicInputs[2],
                payoutAmount: publicInputs[3] / 100 // Convert from cents to dollars
            };
        }

        // Toggle verification section
        function toggleVerification(claimId, event) {
            const section = document.getElementById(`verification-${claimId}`);
            const button = event.currentTarget;
            const svg = button.querySelector('svg');

            if (section.classList.contains('expanded')) {
                section.classList.remove('expanded');
                button.classList.remove('expanded');
                button.innerHTML = `
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                    Show Verification Data
                `;
            } else {
                section.classList.add('expanded');
                button.classList.add('expanded');
                button.innerHTML = `
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                    Hide Verification Data
                `;
            }
        }

        // Copy to clipboard
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = '‚úì Copied';
                button.classList.add('copied');

                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                button.textContent = '‚úó Failed';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            });
        }

        // Initialize
        createParticles();
        fetchDashboardData();

        // Auto-refresh every 3 seconds for real-time balance updates during demo
        setInterval(fetchDashboardData, 3000);
    </script>

    <!-- Demo Animation Overlay -->
    <div id="demoOverlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(11, 14, 28, 0.98); z-index: 10000; overflow: hidden;">
        <div id="timelineContainer" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 1400px;">
            <!-- Timeline will be dynamically inserted here -->
        </div>

        <!-- Skip button -->
        <button id="skipDemo" onclick="endDemo()" style="position: absolute; top: 30px; right: 30px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; transition: all 0.3s;">
            Skip Demo ‚Üí
        </button>
    </div>

    <!-- Start Demo Button (Fixed at bottom) -->
    <div style="position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 1000;">
        <button id="startDemoBtn" onclick="startStoryDemo()" style="
            background: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
            border: none;
            color: white;
            padding: 20px 50px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 10px 40px rgba(153, 69, 255, 0.5);
            transition: all 0.3s ease;
            animation: pulseGlow 2s infinite;
        ">
            ‚ñ∂ Start Demo Animation
        </button>
    </div>

    <style>
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 10px 40px rgba(153, 69, 255, 0.5); transform: scale(1); }
            50% { box-shadow: 0 15px 60px rgba(153, 69, 255, 0.8); transform: scale(1.05); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes progressBar {
            from { width: 0%; }
            to { width: 100%; }
        }

        .timeline-card {
            background: linear-gradient(135deg, rgba(26, 31, 58, 0.9) 0%, rgba(11, 14, 28, 0.9) 100%);
            border: 2px solid rgba(153, 69, 255, 0.5);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 20px 60px rgba(153, 69, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .timeline-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        .timeline-title {
            font-size: 28px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 10px;
        }

        .timeline-subtitle {
            font-size: 16px;
            color: #B8BCC8;
            margin-bottom: 20px;
        }

        .timeline-data {
            background: rgba(0, 212, 255, 0.1);
            border-left: 4px solid #00D4FF;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #FFFFFF;
            line-height: 1.8;
        }

        #skipDemo:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        #startDemoBtn:hover {
            transform: scale(1.08);
            box-shadow: 0 15px 50px rgba(153, 69, 255, 0.7);
        }
    </style>

    <script>
        let demoRunning = false;
        let originalData = null;

        function startDemo() {
            if (demoRunning) return;
            demoRunning = true;

            // Hide start button
            document.getElementById('startDemoBtn').style.display = 'none';

            // Save current dashboard state
            originalData = {
                policies: document.getElementById('recentPolicies').innerHTML,
                claims: document.getElementById('recentClaims').innerHTML,
                stats: {
                    policies: document.getElementById('totalPolicies').textContent,
                    coverage: document.getElementById('totalCoverage').textContent,
                    paid: document.getElementById('claimsPaid').textContent
                }
            };

            // Start live dashboard animation
            runLiveDashboardDemo();
        }

        async function runLiveDashboardDemo() {
            // Don't clear existing data - just add to it!
            // If panels are empty, they'll get populated; if they have data, new entries will be added

            // Sample agent names
            const agents = [
                'trading-bot-alpha',
                'defi-arbitrage-v2',
                'nft-mint-monitor',
                'oracle-price-checker',
                'liquidity-hunter-pro',
                'yield-optimizer-x1'
            ];

            const apis = [
                'api.coingecko.com',
                'api.binance.com',
                'api.uniswap.org',
                'rpc.helius.dev',
                'api.opensea.io',
                'api.jupiter.ag'
            ];

            let policyCount = 0;
            let claimCount = 0;
            let totalCoverage = 0;
            let totalPaid = 0;

            // Animate stats to 0
            animateCounter('totalPolicies', parseInt(document.getElementById('totalPolicies').textContent) || 0, 0, 500);
            animateCounter('totalCoverage', parseFloat(document.getElementById('totalCoverage').textContent.replace('$', '')) || 0, 0, 500);
            animateCounter('claimsPaid', parseFloat(document.getElementById('claimsPaid').textContent.replace('$', '')) || 0, 0, 500);

            await new Promise(resolve => setTimeout(resolve, 1000));

            // Simulate 6 agents buying policies and making claims
            for (let i = 0; i < 6; i++) {
                await new Promise(resolve => setTimeout(resolve, 2000));

                const agent = agents[i];
                const api = apis[i];
                const coverage = (Math.random() * 4 + 1).toFixed(2); // 1-5 USDC
                const premium = (coverage * 0.01).toFixed(3);
                const policyId = generateId();
                const wallet = generateSolanaAddress();

                // Add policy
                addLivePolicy(agent, api, coverage, premium, wallet, policyId);
                policyCount++;
                totalCoverage += parseFloat(coverage);

                animateCounter('totalPolicies', policyCount - 1, policyCount, 300);
                animateCounter('totalCoverage', totalCoverage - parseFloat(coverage), totalCoverage, 300);

                // Execute REAL Solana transaction for policy premium
                const policyTx = await executeRealTransaction('premium', parseFloat(premium), wallet);
                addSolanaActivity('Policy Created', `${agent} ‚Ä¢ ${premium} USDC premium`, policyTx.txHash, 'premium');

                // After 1.5 seconds, simulate claim
                await new Promise(resolve => setTimeout(resolve, 1500));

                const statusCode = [503, 502, 504, 500][Math.floor(Math.random() * 4)];
                const payout = (parseFloat(coverage) * 0.95).toFixed(2); // 95% payout

                // Execute REAL Solana transaction for payout
                const payoutTx = await executeRealTransaction('payout', parseFloat(payout), wallet);

                addLiveClaim(agent, api, statusCode, payout, payoutTx.txHash, policyId);
                claimCount++;
                totalPaid += parseFloat(payout);

                animateCounter('claimsPaid', totalPaid - parseFloat(payout), totalPaid, 300);

                // Add Solana activity for payout
                addSolanaActivity('USDC Transfer', `${payout} USDC ‚Üí ${wallet.substring(0, 8)}...`, payoutTx.txHash, 'payout');

                // Pulse the Solana Explorer widget
                pulseExplorerWidget();
            }

            // Wait a bit then show "Demo Complete" message
            await new Promise(resolve => setTimeout(resolve, 3000));

            // Show completion message
            showDemoComplete(policyCount, totalPaid);

            // Keep the data visible - don't restore!
            // The demo policies, claims, and Solana activity will remain on screen
        }

        function addLivePolicy(agent, api, coverage, premium, wallet, policyId) {
            const container = document.getElementById('recentPolicies');
            if (container.querySelector('.empty-state')) {
                container.innerHTML = '';
            }

            const policyCard = document.createElement('div');
            policyCard.className = 'list-item';
            policyCard.style.animation = 'slideInRight 0.5s ease';
            policyCard.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                    <div>
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">
                            ü§ñ ${agent}
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            Policy ID: ${policyId.substring(0, 8)}...${policyId.substring(policyId.length - 6)}
                        </div>
                    </div>
                    <div style="background: linear-gradient(135deg, #14F195 0%, #9945FF 100%); color: white; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600;">
                        ACTIVE
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px; margin-top: 8px;">
                    <div>
                        <span style="color: var(--text-secondary);">Coverage:</span>
                        <strong style="color: var(--accent-primary);">${coverage} USDC</strong>
                    </div>
                    <div>
                        <span style="color: var(--text-secondary);">Premium:</span>
                        <strong>${premium} USDC</strong>
                    </div>
                </div>
                <div style="font-size: 11px; color: var(--text-secondary); margin-top: 8px;">
                    üéØ Protected API: ${api}
                </div>
                <div style="font-size: 10px; color: var(--text-secondary); margin-top: 4px;">
                    üë§ ${wallet.substring(0, 8)}...${wallet.substring(wallet.length - 6)}
                </div>
            `;

            container.insertBefore(policyCard, container.firstChild);

            // Keep only last 5 policies
            while (container.children.length > 5) {
                container.removeChild(container.lastChild);
            }
        }

        function addLiveClaim(agent, api, statusCode, payout, txHash, policyId) {
            const container = document.getElementById('recentClaims');
            if (container.querySelector('.empty-state')) {
                container.innerHTML = '';
            }

            const claimCard = document.createElement('div');
            claimCard.className = 'list-item';
            claimCard.style.animation = 'slideInRight 0.5s ease';
            claimCard.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                    <div>
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">
                            ‚ö†Ô∏è API Failure - ${agent}
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            Policy: ${policyId.substring(0, 8)}...${policyId.substring(policyId.length - 6)}
                        </div>
                    </div>
                    <div style="background: linear-gradient(135deg, #14F195 0%, #9945FF 100%); color: white; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600;">
                        PAID
                    </div>
                </div>
                <div style="background: rgba(255, 71, 87, 0.1); border-left: 3px solid #FF4757; padding: 10px; border-radius: 6px; margin: 10px 0; font-size: 12px;">
                    <div style="color: #FF4757; font-weight: 600; margin-bottom: 4px;">
                        HTTP ${statusCode} - ${api}
                    </div>
                    <div style="color: var(--text-secondary); font-size: 11px;">
                        API returned error, claim automatically approved
                    </div>
                </div>
                <div style="background: linear-gradient(135deg, rgba(148, 69, 255, 0.1) 0%, rgba(20, 241, 149, 0.1) 100%); padding: 12px; border-radius: 8px; border: 1px solid rgba(153, 69, 255, 0.3);">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9945FF" stroke-width="2">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                        <strong style="color: #9945FF;">Verified on Solana Devnet</strong>
                    </div>
                    <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">
                        Payout: <strong style="color: var(--accent-primary);">${payout} USDC</strong>
                    </div>
                    <div style="font-size: 10px; color: var(--text-secondary);">
                        TX: ${txHash.substring(0, 12)}...${txHash.substring(txHash.length - 8)}
                    </div>
                    <button class="nav-btn" onclick="window.open('https://explorer.solana.com/tx/${txHash}?cluster=devnet', '_blank')" style="margin-top: 8px; font-size: 10px; padding: 4px 8px;">
                        üîç View on Explorer
                    </button>
                </div>
            `;

            container.insertBefore(claimCard, container.firstChild);

            // Keep only last 5 claims
            while (container.children.length > 5) {
                container.removeChild(container.lastChild);
            }
        }

        function animateCounter(elementId, start, end, duration) {
            const element = document.getElementById(elementId);
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;

            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }

                if (elementId === 'totalPolicies') {
                    element.textContent = Math.round(current);
                } else {
                    element.textContent = '$' + current.toFixed(2);
                }
            }, 16);
        }

        function addSolanaActivity(type, description, txHash, activityType) {
            const container = document.getElementById('solanaActivity');
            if (container.querySelector('.empty-state')) {
                container.innerHTML = '';
            }

            const timestamp = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const icon = activityType === 'premium' ? 'üìù' : 'üí∏';
            const color = activityType === 'premium' ? '#9945FF' : '#14F195';

            const activityCard = document.createElement('div');
            activityCard.className = 'list-item';
            activityCard.style.animation = 'slideInRight 0.5s ease, pulse 0.5s ease';
            activityCard.style.borderLeft = `3px solid ${color}`;
            activityCard.innerHTML = `
                <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 8px;">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                            <span style="font-size: 18px;">${icon}</span>
                            <div style="font-weight: 600; color: ${color};">${type}</div>
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 6px;">
                            ${description}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 10px; color: var(--text-secondary);">
                            ${timestamp}
                        </div>
                    </div>
                </div>
                <div style="background: rgba(0, 212, 255, 0.05); border-radius: 6px; padding: 8px; margin-top: 8px;">
                    <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">
                        Transaction Hash:
                    </div>
                    <div style="font-family: 'Courier New', monospace; font-size: 10px; color: var(--accent-primary); word-break: break-all; margin-bottom: 8px;">
                        ${txHash.substring(0, 16)}...${txHash.substring(txHash.length - 12)}
                    </div>
                    <div style="display: flex; gap: 6px;">
                        <button class="nav-btn" onclick="window.open('https://explorer.solana.com/tx/${txHash}?cluster=devnet', '_blank')" style="font-size: 9px; padding: 4px 8px; flex: 1;">
                            üîç Explorer
                        </button>
                        <button class="nav-btn" onclick="window.open('https://solscan.io/tx/${txHash}?cluster=devnet', '_blank')" style="font-size: 9px; padding: 4px 8px; flex: 1;">
                            üìä SolScan
                        </button>
                    </div>
                </div>
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255, 255, 255, 0.05); display: flex; align-items: center; justify-content: space-between;">
                    <div style="font-size: 9px; color: var(--text-secondary); display: flex; align-items: center; gap: 4px;">
                        <span style="color: #14F195;">‚ö°</span> Confirmed in ~400ms
                    </div>
                    <div style="background: rgba(20, 241, 149, 0.1); padding: 2px 8px; border-radius: 8px; font-size: 9px; color: #14F195; font-weight: 600;">
                        ‚úì CONFIRMED
                    </div>
                </div>
            `;

            container.insertBefore(activityCard, container.firstChild);

            // Keep only last 8 activities
            while (container.children.length > 8) {
                container.removeChild(container.lastChild);
            }

            // Flash the Solana Activity header
            const solanaCard = activityCard.closest('.card');
            if (solanaCard) {
                solanaCard.style.transition = 'box-shadow 0.3s ease';
                solanaCard.style.boxShadow = `0 0 30px ${color}`;
                setTimeout(() => {
                    solanaCard.style.boxShadow = '';
                }, 300);
            }
        }

        function pulseExplorerWidget() {
            const widget = document.querySelector('.card');
            if (widget) {
                widget.style.transition = 'transform 0.3s ease, box-shadow 0.3s ease';
                widget.style.transform = 'scale(1.02)';
                widget.style.boxShadow = '0 20px 60px rgba(153, 69, 255, 0.5)';

                setTimeout(() => {
                    widget.style.transform = 'scale(1)';
                    widget.style.boxShadow = '';
                }, 300);
            }
        }

        function showDemoComplete(policies, paid) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, rgba(26, 31, 58, 0.98) 0%, rgba(11, 14, 28, 0.98) 100%);
                border: 3px solid rgba(153, 69, 255, 0.8);
                border-radius: 20px;
                padding: 40px 60px;
                z-index: 10001;
                text-align: center;
                animation: zoomIn 0.5s ease;
                box-shadow: 0 30px 90px rgba(153, 69, 255, 0.6);
            `;
            overlay.innerHTML = `
                <div style="font-size: 64px; margin-bottom: 20px;">üéâ</div>
                <div style="font-size: 32px; font-weight: 700; color: #FFFFFF; margin-bottom: 15px;">
                    Demo Complete!
                </div>
                <div style="font-size: 18px; color: #B8BCC8; margin-bottom: 25px;">
                    ${policies} agents protected ‚Ä¢ $${paid.toFixed(2)} paid out
                </div>
                <div style="font-size: 14px; color: var(--accent-primary);">
                    ‚ö° All on Solana Devnet in under 500ms per transaction
                </div>
            `;
            document.body.appendChild(overlay);

            setTimeout(() => {
                overlay.style.transition = 'opacity 0.5s ease';
                overlay.style.opacity = '0';
                setTimeout(() => overlay.remove(), 500);
            }, 3500);
        }

        function generateId() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
                const r = Math.random() * 16 | 0;
                return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
            });
        }

        function generateSolanaAddress() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz123456789';
            let result = '';
            for (let i = 0; i < 44; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function generateTxHash() {
            return generateSolanaAddress();
        }

        async function executeRealTransaction(type, amount, recipient = null) {
            /**
             * Execute a real Solana transaction
             * @param {string} type - 'premium' or 'payout'
             * @param {number} amount - Amount in USDC
             * @param {string} recipient - Optional recipient address
             * @returns {Promise<{txHash: string, explorerUrl: string}>}
             */
            try {
                const response = await fetch('/api/demo/transaction', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: type,
                        amount: amount,
                        recipient: recipient
                    })
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'Transaction failed');
                }

                return {
                    txHash: data.txHash,
                    explorerUrl: data.explorerUrl,
                    solscanUrl: data.solscanUrl
                };

            } catch (error) {
                console.error('Real transaction failed:', error);
                // Fallback to mock transaction if real one fails
                return {
                    txHash: generateTxHash(),
                    explorerUrl: '#',
                    solscanUrl: '#',
                    isMock: true
                };
            }
        }

        function restoreDashboard() {
            if (originalData) {
                document.getElementById('recentPolicies').innerHTML = originalData.policies;
                document.getElementById('recentClaims').innerHTML = originalData.claims;
                document.getElementById('totalPolicies').textContent = originalData.stats.policies;
                document.getElementById('totalCoverage').textContent = originalData.stats.coverage;
                document.getElementById('claimsPaid').textContent = originalData.stats.paid;
            }
            endDemo();
        }

        async function runTimelineAnimation() {
            const container = document.getElementById('timelineContainer');

            // Timeline steps with realistic Solana data
            const steps = [
                {
                    icon: 'ü§ñ',
                    title: 'AI Agent Needs Protection',
                    subtitle: 'Agent preparing to call external API',
                    data: `Agent: autonomous-trader-bot-7x91
Wallet: FvhgYhav7wc514G7VtGNNDNKUMFTB21CwE517hdwPP7Y
Target API: https://api.trading-platform.io/v1/execute
Operation: High-value trading decision
Budget: 2.5 USDC per call`,
                    delay: 0
                },
                {
                    icon: 'üí≥',
                    title: 'Premium Payment via x402',
                    subtitle: 'Agent pays 1% premium (0.025 USDC) for 2.5 USDC coverage',
                    data: `Payment Method: x402 Protocol (ed25519 signature)
Premium: 0.025 USDC (1%)
Coverage: 2.5 USDC
Duration: 24 hours
Signature: 5Kj8p2m...9Xc4Lq (verified ‚úì)`,
                    delay: 2000
                },
                {
                    icon: 'üìú',
                    title: 'Policy Activated',
                    subtitle: 'Insurance policy created on-chain',
                    data: `Policy ID: 8f3c9a2e-5b1d-4e76-a829-c3d4f5e67890
Status: ACTIVE ‚úì
Coverage: 2.5 USDC
Premium Paid: 0.025 USDC
Merchant: api.trading-platform.io
Expires: 2025-11-11 13:44:22 UTC
Protected Wallet: FvhgYhav7wc514G...hdwPP7Y`,
                    delay: 4000
                },
                {
                    icon: '‚ö†Ô∏è',
                    title: 'API Failure Detected',
                    subtitle: 'Merchant API returns 503 Service Unavailable',
                    data: `HTTP/1.1 503 Service Unavailable
Server: nginx/1.21.6
Content-Length: 0
Connection: close

ERROR: Service temporarily unavailable
Agent lost: 2.5 USDC üö®`,
                    delay: 6500
                },
                {
                    icon: 'üîê',
                    title: 'Zero-Knowledge Proof Generated',
                    subtitle: 'zkEngine creates cryptographic proof of API failure',
                    data: `Proving System: NovaNet (Nebula/SuperNova)
Proof Hash: 0x7a3f9b2c8e5d1a6f4b9c3e7d2a5f8b1c9e4d7a3f6b2c8e5d1a...
Public Inputs: [1, 503, 0, 2500000]
  ‚îú‚îÄ Failure Detected: 1 (TRUE)
  ‚îú‚îÄ HTTP Status: 503
  ‚îú‚îÄ Response Size: 0 bytes
  ‚îî‚îÄ Payout: 2.5 USDC

Generation Time: 127ms ‚ö°
Verification: PASSED ‚úì`,
                    delay: 9000
                },
                {
                    icon: '‚úÖ',
                    title: 'Lightning-Fast USDC Payout',
                    subtitle: 'Refund processed on Solana Devnet in 412ms',
                    data: `Solana Transaction: 5LBsAam7aGAqo6iBcWtTywDzrX8yU...
Network: Devnet
Token: USDC (4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU)
Amount: 2.5 USDC
Recipient: FvhgYhav7wc514G7VtGNNDNKUMFTB21CwE517hdwPP7Y
Finality: 412ms ‚ö°
Status: CONFIRMED ‚úì

View on Explorer:
https://explorer.solana.com/tx/5LBsAam7a...`,
                    delay: 11500
                },
                {
                    icon: 'üéâ',
                    title: 'Agent Protected & Profitable',
                    subtitle: 'Complete protection against API failures',
                    data: `Summary:
‚úì Premium Paid: 0.025 USDC
‚úì Coverage: 2.5 USDC
‚úì API Failed: YES (HTTP 503)
‚úì Proof Generated: 127ms
‚úì Refund Received: 2.5 USDC in 412ms
‚úì Net Result: +2.475 USDC profit

Agent continues operations safely üöÄ
No downtime, no losses, fully protected!`,
                    delay: 14500
                }
            ];

            // Display each step
            for (let i = 0; i < steps.length; i++) {
                await new Promise(resolve => setTimeout(resolve, steps[i].delay));

                if (!demoRunning) return; // Check if demo was skipped

                const card = document.createElement('div');
                card.className = 'timeline-card';
                card.style.animation = 'slideInRight 0.6s ease';
                card.innerHTML = `
                    <span class="timeline-icon">${steps[i].icon}</span>
                    <div class="timeline-title">${steps[i].title}</div>
                    <div class="timeline-subtitle">${steps[i].subtitle}</div>
                    <div class="timeline-data">${steps[i].data}</div>
                    ${i < steps.length - 1 ? '<div style="text-align: center; margin-top: 20px; font-size: 24px; color: #9945FF;">‚Üì</div>' : ''}
                `;

                // Clear previous or append
                if (i === 0) {
                    container.innerHTML = '';
                }
                container.appendChild(card);

                // Scroll to show new card
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            // Wait then zoom back to dashboard
            await new Promise(resolve => setTimeout(resolve, 3000));
            if (demoRunning) {
                zoomBackToDashboard();
            }
        }

        function zoomBackToDashboard() {
            const overlay = document.getElementById('demoOverlay');
            overlay.style.transition = 'all 1.5s ease';
            overlay.style.transform = 'scale(0.8)';
            overlay.style.opacity = '0';

            setTimeout(() => {
                endDemo();
                // Trigger dashboard data refresh to show new data
                fetchDashboardData();
            }, 1500);
        }

        function endDemo() {
            demoRunning = false;
            document.getElementById('demoOverlay').style.display = 'none';
            document.getElementById('startDemoBtn').style.display = 'block';
            document.getElementById('timelineContainer').innerHTML = '';
        }
    </script>

    <!-- Story Demo Script -->
    <script src="/story-demo.js"></script>
</body>
</html>
